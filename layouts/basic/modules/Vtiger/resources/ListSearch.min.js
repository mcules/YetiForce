
jQuery.Class("YetiForce_ListSearch_Js",{getInstance:function(c,b){var e=app.getModuleName();var d=e+"_ListSearch_Js";var f="YetiForce_ListSearch_Js";if(typeof window[d]!="undefined"){var a=new window[d](c,b)}else{var a=new window[f](c,b)}return a}},{container:false,init:function(b,a){var c=this;if(typeof b=="undefined"){b=jQuery(".bodyContents")}this.setContainer(b);if(a!=true&&this.getContainer().find('[data-trigger="listSearch"]').length){this.initialize()}},setContainer:function(a){this.container=a},getContainer:function(){return this.container},initialize:function(){this.registerEvents()},getAlphabetSearchField:function(){return jQuery("#alphabetSearchKey").val()},getAlphabetSearchValue:function(){return jQuery("#alphabetValue").val()},registerListSearch:function(){var a=this;var b=this.getContainer();b.find('[data-trigger="listSearch"]').on("click",function(c){a.reloadList()});b.find("input.listSearchContributor").on("keypress",function(c){if(c.keyCode==13){a.triggerListSearch()}});b.find(".removeSearchConditions").on("click",function(){a.reloadList({search_params:[],search_key:"",search_value:"",operator:""})})},registerListViewSelect:function(){var a=this;var b=this.getContainer();b.find(".listViewEntriesTable .select2noactive").each(function(d,e){var c=$(e);if(!c.data("select2")){app.showSelect2ElementView(c,{placeholder:app.vtranslate("JS_SELECT_AN_OPTION")})}});if(app.getMainParams("autoRefreshListOnChange")=="1"){b.find(".listViewEntriesTable select").on("change",function(c){a.triggerListSearch()});b.find(".listViewEntriesTable .dateField").on("DatePicker.onHide",function(d,g){var f=$(this).data("prevVal");var c=$(this).val();if(f!=c){a.triggerListSearch()}})}},resetPagination:function(){jQuery("#deSelectAllMsg").trigger("click");jQuery("#recordsCount").val("");jQuery("#pageNumber").val("1");jQuery("#pageToJump").val("1");jQuery("#totalPageCount").text("");jQuery(".pagination").data("totalCount",0)},triggerListSearch:function(){var a=this;var b=a.getContainer();b.find('[data-trigger="listSearch"]').trigger("click")},registerDateListSearch:function(a){var b=this;var c=this.getContainer();c.find(".dateField").each(function(d,e){var g=jQuery(e);var f={calendars:3,mode:"range",className:"rangeCalendar",onChange:function(h){g.data("prevVal",g.val());g.val(h.join(","))},onHide:function(h){g.trigger(jQuery.Event("DatePicker.onHide"),h)}};app.registerEventForDatePickerFields(g,false,f)})},registerTimeListSearch:function(){app.registerEventForTimeFields(this.getContainer(),false)},registerAlphabetClick:function(){var a=this;this.getContainer().find(".alphabetBtn").on("click",function(){app.showModalWindow($(".alphabetModal").html(),function(b){a.registerEventForAlphabetSearch(b)})})},getCurrentCvId:function(){return jQuery("#customFilter").find("option:selected").data("id")},registerEventForAlphabetSearch:function(a){var b=this;a.find(".alphabetSearch").on("click",function(h){var g=jQuery(h.currentTarget).find("a").text();var f=b.getCurrentCvId();var c=b.getAlphabetSearchField();var d={viewname:f,search_key:c,search_value:g,operator:"s",page:1};b.resetPagination();b.reloadList(d);app.hideModalWindow()});a.find(".removeAlfabetCondition").on("click",function(){b.reloadList({search_key:"",search_value:"",operator:""});app.hideModalWindow()})},updatePaginationOnAlphabetChange:function(c,a){var b=this;var d={};d.module=app.getModuleName();d.parent=app.getParentModuleName();d.view="Pagination";d.page=1;d.mode="getPagination";d.search_key=a;d.search_value=c;d.operator="s";AppConnector.request(d).then(function(f){jQuery(".paginationDiv").html(f);var e=b.getInstanceView();if(e&&e!=undefined&&jQuery.isFunction(e.registerPageNavigationEvents)){e.registerPageNavigationEvents()}})},getListSearchParams:function(d){var c=this.getContainer();var a=c.find(".listViewEntriesTable");var e=new Array();a.find(".listSearchContributor").each(function(l,k){var h=new Array();var m=jQuery(k);var g=m.data("fieldinfo");var n=m.attr("name");var f=m.val();if(typeof f=="object"){if(f==null){f=""}else{f=f.join(",")}}f=f.trim();if(f.length<=0){return true}var j="c";if(g.hasOwnProperty("searchOperator")){j=g.searchOperator}else{if(g.type=="date"||g.type=="datetime"){j="bw"}else{if(g.type=="boolean"||g.type=="picklist"||g.type=="tree"){j="e"}else{if(g.type=="currency"||g.type=="double"||g.type=="percentage"||g.type=="integer"||g.type=="number"){if(f.substring(0,2)==">="){j="h"}else{if(f.substring(0,2)=="<="){j="m"}else{if(f.substring(0,1)==">"){j="g"}else{if(f.substring(0,1)=="<"){j="l"}else{j="e"}}}}}}}}h.push(n);h.push(j);h.push(f);if(g.type=="tree"){var i=jQuery('.listViewHeaders #searchInSubcategories[data-columnname="'+n+'"]').prop("checked");h.push(i)}e.push(h)});if(d){var b=app.getUrlVar("search_params");if(b!=undefined&&b.length){b=jQuery.parseJSON(decodeURIComponent(b));$.each(b[0],function(f,h){var g=false;$.each(e,function(i,j){if(j[0]==h[0]){g=true}});if(g==false){e.push(h)}})}}return new Array(e)},getInstanceByView:function(){var b=app.getViewName();var a=false;if(b==="Detail"){a=Vtiger_Detail_Js.getInstance();a.reloadFunctionName="loadRelatedList"}else{if(b=="List"){a=new Vtiger_List_Js();a.reloadFunctionName="getListViewRecords";a.execute=["updatePagination"]}}return a},reloadList:function(d){var b=this;if(d==undefined){d={page:1}}var a=this.getInstanceByView();if(a){var c=a.reloadFunctionName;if(jQuery.isFunction(a[c])){a[c](d).then(function(){b.resetPagination();b.executeFunctions(a)})}}},executeFunctions:function(a){var d=this;if(a.execute){var c=a.execute;for(var b in c){var e=c[b];if(jQuery.isFunction(a[e])){a[e]()}}}},registerBasicEvents:function(){this.registerListViewSelect();this.registerDateListSearch();this.registerTimeListSearch();this.registerAlphabetClick();this.registerListSearch();this.getContainer().find("select.select2").each(function(a,b){if(!$(b).data("select2")){app.showSelect2ElementView($(b))}})},registerEvents:function(){this.registerBasicEvents()}});