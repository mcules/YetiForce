
jQuery.Class("Settings_BackUp_Index_Js",{},{performBackup:function(b){var a=this;var c={parent:app.getParentModuleName(),module:"BackUp",action:"Backup",mode:"perform",step:b,};AppConnector.request(c).then(function(d){Vtiger_Helper_Js.showPnotify({text:d.result.message,type:"info"})})},registerPerformBackup:function(b){var a=this;b.find(".runBackup").on("click",function(c){a.performBackup(1)})},registerStopBackup:function(a){a.find(".stopBackup").on("click",function(b){var c={parent:app.getParentModuleName(),module:"BackUp",action:"Backup",mode:"stopBackup",};AppConnector.request(c).then(function(d){location.reload()})})},updateProgressBar:function(c){var d=3000;var b=this;var a=jQuery.Deferred();var e={parent:app.getParentModuleName(),module:"BackUp",action:"Backup",mode:"progress",id:c.find(".backupID").val(),};AppConnector.request(e).then(function(f){if(f.result!=false){$.each(f.result,function(h,i){var j=c.find(".row-bar."+h);var g=j.find(".progress");j.find(".progress-bar").width(i+"%");j.find(".precent").text(i);if(i>=100&&h!="mainBar"){g.removeClass("active");g.removeClass("progress-info")}else{if(h!="mainBar"){g.addClass("progress-success")}}});setTimeout(function(){b.updateProgressBar(c)},d)}a.resolve(f.result)},function(f){a.reject()});return a.promise()},registerProgressBar:function(b){var a=this;a.updateProgressBar(b)},registerSaveBackupSetting:function(b){var a=this;b.find(".configField").on("switchChange.bootstrapSwitch",function(c,d){var e=$(c.currentTarget);a.registerSave(e,d)}).on("change",function(d){var c=$(d.currentTarget);a.registerSave(c,c.val())})},registerSave:function(b,a){var c={};c.type=b.data("type");c.param=b.attr("name");c.val=a;app.saveAjax("updateSettings",c).then(function(d){Settings_Vtiger_Index_Js.showMessage({type:"success",text:d.result.message})})},registerSaveFTPConfigEvent:function(b){var a=this;b.find("#saveFtpConfig").on("click",function(j){var l=a.validFtpSettings();if(false===l){return false}var f=jQuery('#tab_2 [name="host"]').val();var i=jQuery('#tab_2 [name="login"]').val();var c=jQuery('#tab_2 [name="password"]').val();var k=jQuery('#tab_2 [name="port"]').val();var g=jQuery('#tab_2 [name="path"]').val();var h=jQuery('#tab_2 [name="active"]').is(":checked");var d={};d.data={parent:app.getParentModuleName(),module:"BackUp",action:"Backup",mode:"saveftp",ftpservername:f,ftplogin:i,ftppassword:c,ftpport:k,ftppath:g,ftpactive:h};d.dataType="json";AppConnector.request(d).then(function(m){var e=m.result;if(e.fptConnection==true){$("#connection-status").css("background-color","#5bb75b");var n={text:app.vtranslate(e.message),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(n)}else{$("#connection-status").css("background-color","red");var n={text:app.vtranslate(e.message),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(n)}});j.preventDefault();return})},validFtpSettings:function(){var c=jQuery('#tab_2 [name="host"]').val();var b=jQuery('#tab_2 [name="login"]').val();var f=jQuery('#tab_2 [name="password"]').val();var e=jQuery('#tab_2 [name="port"]').val();var a=true;if(0==c.length||0==b.length||0==f.length){var d={text:app.vtranslate("JS_MANDATORY_FIELDS_EMPTY"),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(d);a=false}if(isNaN(e)){var d={text:app.vtranslate("JS_PORT_ONLY_NUMBERS"),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(d);a=false}return a},registerNextPagePaginationEvent:function(b){var a=this;b.find("#listViewNextPageButton").on("click",function(f){var c=b.find(".ftp-button").attr("title");var h={};var g=b.find(".offset").val();var d=parseInt(b.find(".current-page").val())+1;h.data={module:"BackUp",action:"Pagination",offset:g,page:d,ajaxCall:true,parent:app.getParentModuleName()};h.dataType="json";AppConnector.request(h).then(function(i){var e=i.result;if(i.success==true){a.registerUpdateBackUpList(b,i)}});f.preventDefault();return})},registerPrevPagePaginationEvent:function(b){var a=this;b.find("#listViewPreviousPageButton").on("click",function(d){var g={};var f=b.find(".offset").val();var c=parseInt(b.find(".current-page").val())-1;g.data={module:"BackUp",action:"Pagination",offset:f,page:c,ajaxCall:true,parent:app.getParentModuleName()};g.dataType="json";AppConnector.request(g).then(function(h){var e=h.result;if(h.success==true){a.registerUpdateBackUpList(b,h)}});d.preventDefault();return})},registerSetPaginationNavigation:function(c){var b=c.find(".next-page").val();var a=c.find(".prev-page").val();if(b==true){c.find("#listViewNextPageButton").prop("disabled",false)}else{c.find("#listViewNextPageButton").prop("disabled",true)}if(a==true){c.find("#listViewPreviousPageButton").prop("disabled",false)}else{c.find("#listViewPreviousPageButton").prop("disabled",true)}},registerUpdateBackUpList:function(c,d){var b=this;c.find(".offset").val(d.result.offset);c.find(".current-page").val(d.result.page);c.find(".next-page").val(d.result.nextPage);c.find(".prev-page").val(d.result.prevPage);b.registerSetPaginationNavigation(c);var a=c.find(".ftp-button").attr("title");c.find(".backup-list").empty();jQuery(d.result.backups).each(function(){c.find(".backup-list").append('<tr><td><label class="marginRight5px" >'+this.starttime+'</label></td><td><label class="marginRight5px" >'+this.endtime+'</label></td><td><label class="marginRight5px" >'+this.filename+'</label></td><td><label class="marginRight5px" >'+this.status+'</label></td><td><label class="marginRight5px" >'+this.backuptime+"</label></td></tr>")})},registerEvents:function(){var a=$(".contentsDiv");this.registerPerformBackup(a);this.registerStopBackup(a);this.registerProgressBar(a);this.registerSaveBackupSetting(a);this.registerSaveFTPConfigEvent(a);this.registerSetPaginationNavigation(a);this.registerNextPagePaginationEvent(a);this.registerPrevPagePaginationEvent(a)}});