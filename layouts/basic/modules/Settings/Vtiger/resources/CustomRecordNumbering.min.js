
jQuery.Class("Settings_CustomRecordNumbering_Js",{},{form:false,getForm:function(){if(this.form==false){this.form=jQuery("#EditView")}return this.form},registerOnChangeEventOfSourceModule:function(){var a=this.getForm();a.find('[name="sourceModule"]').on("change",function(d){jQuery(".saveButton").removeAttr("disabled");var c=jQuery(d.currentTarget);var f={};var b=c.val();f={module:app.getModuleName(),parent:app.getParentModuleName(),action:"CustomRecordNumberingAjax",mode:"getModuleCustomNumberingData",sourceModule:b};AppConnector.request(f).then(function(e){if(e){a.find('[name="prefix"]').val(e.result.prefix);a.find('[name="postfix"]').val(e.result.postfix);a.find('[name="sequenceNumber"]').val(e.result.sequenceNumber);a.find('[name="sequenceNumber"]').data("oldSequenceNumber",e.result.sequenceNumber)}},function(e,h,g){})})},saveModuleCustomNumbering:function(){if(jQuery(".saveButton").attr("disabled")){return}var d=this.getForm();var f={};var g=d.find('[name="sourceModule"]').val();var k=d.find('option[value="'+g+'"]').text();var h=d.find('[name="prefix"]');var b=jQuery.trim(h.val());var i=h.data("oldPrefix");var m=d.find('[name="postfix"]');var e=jQuery.trim(m.val());var n=m.data("oldPostfix");var a=d.find('[name="sequenceNumber"]');var l=a.val();var c=a.data("oldSequenceNumber");if((l<c)&&(b==i)&&(e==n)){var j=app.vtranslate("JS_SEQUENCE_NUMBER_MESSAGE")+" "+c;a.validationEngine("showPrompt",j,"error","topLeft",true);return}f={module:app.getModuleName(),parent:app.getParentModuleName(),action:"CustomRecordNumberingAjax",mode:"saveModuleCustomNumberingData",sourceModule:g,prefix:b,postfix:e,sequenceNumber:l};jQuery(".saveButton").attr("disabled","disabled");AppConnector.request(f).then(function(p){var r;var q=app.vtranslate("JS_RECORD_NUMBERING_SAVED_SUCCESSFULLY_FOR")+" "+k;if(p.success==true){r={text:q};Settings_Vtiger_Index_Js.showMessage(r)}else{var o=b+" "+app.vtranslate(p.error.message);r={text:o,type:"error"};Settings_Vtiger_Index_Js.showMessage(r)}},function(o,q,p){})},registerEventToUpdateRecordsWithSequenceNumber:function(){var a=this.getForm();a.find('[name="updateRecordWithSequenceNumber"]').on("click",function(){var d={};var b=a.find('[name="sourceModule"]').val();var c=a.find('option[value="'+b+'"]').text();d={module:app.getModuleName(),parent:app.getParentModuleName(),action:"CustomRecordNumberingAjax",mode:"updateRecordsWithSequenceNumber",sourceModule:b};AppConnector.request(d).then(function(e){var f=app.vtranslate("JS_RECORD_NUMBERING_UPDATED_SUCCESSFULLY_FOR")+" "+c;if(e.success==true){var g={text:f};Settings_Vtiger_Index_Js.showMessage(g)}else{Settings_Vtiger_Index_Js.showMessage(e.error.message)}},function(e,g,f){})})},registerChangeEventForPrefixAndSequenceNumber:function(){var a=this.getForm();a.find('[name="prefix"],[name="sequenceNumber"]').on("change",function(){jQuery(".saveButton").removeAttr("disabled")})},registerRelatedFieldsChangeEvent:function(b){var a=this;b.find('[name="custom_variables"]').on("change",function(){a.updateRelatedFieldsValue(b)})},updateRelatedFieldsValue:function(a){var b="{{"+a.find('[name="custom_variables"]').val()+"}}";a.find("#customVariable").val(b)},registerCopyClipboard:function(a){var b=new ZeroClipboard(a,{moviePath:"libraries/jquery/ZeroClipboard/ZeroClipboard.swf"});b.on("complete",function(c,d){var e={text:app.vtranslate("JS_NOTIFY_COPY_TEXT"),animation:"show",title:app.vtranslate("JS_NOTIFY_COPY_TITLE"),type:"success"};Vtiger_Helper_Js.showPnotify(e)})},registerEvents:function(){var a=this;var c=this.getForm();this.registerOnChangeEventOfSourceModule();this.registerEventToUpdateRecordsWithSequenceNumber();this.registerChangeEventForPrefixAndSequenceNumber();var b=app.validationEngineOptions;b.onValidationComplete=function(e,d){if(d){a.saveModuleCustomNumbering()}return false};c.validationEngine("detach");c.validationEngine("attach",b);this.registerRelatedFieldsChangeEvent(c);this.updateRelatedFieldsValue(c);this.registerCopyClipboard(c.find("#customVariableCopy"))}});jQuery(document).ready(function(){var a=new Settings_CustomRecordNumbering_Js();a.registerEvents()});