
jQuery.Class("Settings_Vtiger_CompanyDetails_Js",{},{registerUpdateDetailsClickEvent:function(){jQuery("#updateCompanyDetails").on("click",function(a){jQuery("#companyDetailsContainer").addClass("hide");jQuery("#updateCompanyDetailsForm").removeClass("hide");jQuery("#updateCompanyDetails").addClass("hide");jQuery("#addCustomFieldForm").addClass("hide");jQuery("#addCustomField").addClass("hide")})},registerAddFieldEvent:function(){var b=this;var a=jQuery(".contentsDiv ");a.find("#addCustomField").on("click",function(f){var d=a.find(".addCustomFieldModal").clone(true,true);var c=function(g){g.find(".addCustomFieldModal").removeClass("hide").show();var e=g.find(".addCustomBlockForm");jQuery('[name="saveButton"]').off("click").on("click",function(){var h=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});b.registerSaveCompanyDetailsEvent(e).then(function(j){var k={};var i=j.result;if(i.success==true){k.text=i.message;Settings_Vtiger_Index_Js.showMessage(k);var k={};k.module=app.getModuleName();k.view="CompanyDetails";k.parent=app.getParentModuleName();AppConnector.request(k).then(function(l){jQuery(".contentsDiv").html(l);b.registerEvents();h.progressIndicator({mode:"hide"})})}else{h.progressIndicator({mode:"hide"});k.text=i.message;k.type="error";Settings_Vtiger_Index_Js.showMessage(k)}});app.hideModalWindow();return true});jQuery(".cancelLink").off("click").on("click",function(){var h=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var i={};i.module=app.getModuleName();i.view="CompanyDetails";i.parent=app.getParentModuleName();AppConnector.request(i).then(function(j){jQuery(".contentsDiv").html(j);b.registerEvents();h.progressIndicator({mode:"hide"})})});e.submit(function(h){h.preventDefault()})};app.showModalWindow(d,function(e){if(typeof c=="function"){c(e)}})})},registerSaveCompanyDetailsEvent:function(c){var b=this;var e=$(".addCustomBlockForm").serializeFormData();e.module=app.getModuleName();e.parent=app.getParentModuleName();e.action="CompanyDetailsFieldSave";if(e.fieldName==""){var e=[];e.text=app.vtranslate("JS_FILL_FORM_ERROR");e.type="error";Settings_Vtiger_Index_Js.showMessage(e);var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={};e.module=app.getModuleName();e.view="CompanyDetails";e.parent=app.getParentModuleName();AppConnector.request(e).then(function(f){jQuery(".contentsDiv").html(f);b.registerEvents();d.progressIndicator({mode:"hide"})})}else{var a=jQuery.Deferred();AppConnector.request(e).then(function(f){a.resolve(f)},function(f){a.reject(f)});return a.promise()}return true},registerCancelClickEvent:function(){jQuery("#updateCompanyDetailsForm button:reset").on("click",function(){jQuery("#addCustomField").removeClass("hide");jQuery("#companyDetailsContainer").removeClass("hide");jQuery("#updateCompanyDetailsForm").addClass("hide");jQuery("#updateCompanyDetails").removeClass("hide");jQuery("#addCustomFieldForm").removeClass("hide");jQuery("#addCustomFieldForm").addClass("hide")})},checkValidation:function(){var g=jQuery("#logoFile");var e=g.val();if(e!=""){var f=new Array();f=e.split(".");var d=f.length-1;if(d<0){g.validationEngine("showPrompt",app.vtranslate("LBL_WRONG_IMAGE_TYPE"),"error","topLeft",true);g.val("");return false}var b=JSON.parse(jQuery("#supportedImageFormats").val());var a=f[d].toLowerCase();if(b.indexOf(a)!="-1"){var c=g[0].files[0].size;if(c<1024000){return true}else{g.validationEngine("showPrompt",app.vtranslate("LBL_MAXIMUM_SIZE_EXCEEDS"),"error","topLeft",true);return false}}else{g.validationEngine("showPrompt",app.vtranslate("LBL_WRONG_IMAGE_TYPE"),"error","topLeft",true);g.val("");return false}}},getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),b=c.exec(location.search);return b===null?"":decodeURIComponent(b[1].replace(/\+/g," "))},registerEvents:function(){this.registerUpdateDetailsClickEvent();this.registerCancelClickEvent();this.registerAddFieldEvent();jQuery("#updateCompanyDetailsForm").validationEngine(app.validationEngineOptions)}});