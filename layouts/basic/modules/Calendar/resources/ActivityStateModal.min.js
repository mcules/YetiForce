
jQuery.Class("Calendar_ActivityStateModal_Js",{},{registerActivityState:function(){var a=this;jQuery("#activityStateModal button:not(.close)").on("click",function(i){var h=jQuery(i.currentTarget);h.closest(".modal").addClass("hide");if(a.saveResultInstance==undefined){a.saveResultInstance=new SaveResult()}if(h.data("type")=="1"){a.updateActivityState(h)}if(h.hasClass("showQuickCreate")){var g=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d="Calendar";var c="index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord="+h.data("id");var j={};j.noCache=true;var f=h.closest(".modalEditStatus").find(".modalSummaryValues .fieldVal").data("subject");var b=Vtiger_Header_Js.getInstance();b.getQuickCreateForm(c,d,j).then(function(k){g.progressIndicator({mode:"hide"});if(h.data("type")=="0"&&typeof f!="undefinied"&&f.length>0){k=jQuery(k);var e=k.find('[name="subject"]');if(e.length){e.val(f)}}b.handleQuickCreateData(k,{callbackFunction:function(l){if(l&&l.success&&l.result.followup.value==h.data("id")){a.updateActivityState(h)}var m={};m.record=h.data("id");m.module="Calendar";m.view="quick_edit";m.activitystatus=h.data("state");a.saveResultInstance.checkData(m)}})})}})},updateActivityState:function(c){var a=this;var d={module:"Calendar",action:"ActivityStateAjax",record:c.data("id"),state:c.data("state")};app.hideModalWindow();var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(d).then(function(j){if(j.success){var k=app.getViewName();if(k==="Detail"){var i=jQuery(".activityWidgetContainer .widgetContentBlock");var h=Vtiger_Detail_Js.getInstance();if(i.length){h.loadWidget(i)}else{var f=h.getTabByLabel(h.detailViewRecentActivitiesTabLabel);if(f){f.trigger("click")}if(app.getModuleName()=="Calendar"){f=((!h.getSelectedTab().length||h.getSelectedTab().data("linkKey")==h.detailViewDetailsTabLabel)?h.getTabContainer().find('[data-link-key="'+h.detailViewDetailsTabLabel+'"]:not(.hide)'):jQuery("<div></div>"));jQuery(".showModal.closeCalendarRekord").addClass("hide");f.trigger("click")}}}if(k=="List"){var g=new Vtiger_List_Js();g.getListViewRecords()}if(k=="DashBoard"){var e=new Vtiger_DashBoard_Js();e.getContainer().find('a[name="drefresh"]').trigger("click")}if(app.getModuleName()=="Calendar"&&k=="Calendar"){var e=Calendar_CalendarView_Js.getInstanceByView();e.loadCalendarData()}Vtiger_Index_Js.requestReminder();b.progressIndicator({mode:"hide"})}else{return false}})},registerEvents:function(){this.registerActivityState()}});jQuery(document).ready(function(b){var a=new Calendar_ActivityStateModal_Js();a.registerEvents()});