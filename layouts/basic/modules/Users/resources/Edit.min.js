
Vtiger_Edit_Js("Users_Edit_Js",{registerChangeEventForCurrencySeperator:function(){var a=jQuery("form");jQuery('[name="currency_decimal_separator"]',a).on("change",function(h){var d=jQuery(h.currentTarget);var c=d.val();var b=jQuery('[name="currency_grouping_separator"]',a).data("selectedValue");if(b==c){var g=app.vtranslate("JS_DECIMAL_SEPERATOR_AND_GROUPING_SEPERATOR_CANT_BE_SAME");var i={text:g,type:"error"};Vtiger_Helper_Js.showMessage(i);var f=d.data("selectedValue");d.find("option").removeAttr("selected");d.find('option[value="'+f+'"]').attr("selected","selected");d.trigger("chosen:updated")}else{d.data("selectedValue",c)}});jQuery('[name="currency_grouping_separator"]',a).on("change",function(h){var c=jQuery(h.currentTarget);var b=c.val();var f=jQuery('[name="currency_decimal_separator"]',a).data("selectedValue");if(f==b){var g=app.vtranslate("JS_DECIMAL_SEPERATOR_AND_GROUPING_SEPERATOR_CANT_BE_SAME");var i={text:g,type:"error"};Vtiger_Helper_Js.showMessage(i);var d=c.data("selectedValue");c.find("option").removeAttr("selected");c.find('option[value="'+d+'"]').attr("selected","selected");c.trigger("chosen:updated")}else{c.data("selectedValue",b)}})}},{duplicateCheckCache:{},userExistCheckCache:{},passCheckCache:{},hourFormatConditionMapping:false,registerWidthChangeEvent:function(){var a=app.cacheGet("widthType","narrowWidthType");jQuery("#currentWidthType").html(jQuery('li[data-class="'+a+'"]').html());jQuery("#widthType").on("click","li",function(c){var b=jQuery(c.currentTarget).data("class");app.cacheSet("widthType",b);jQuery("#currentWidthType").html(jQuery(c.currentTarget).html());window.location.reload()})},registerHourFormatChangeEvent:function(){},changeStartHourValuesEvent:function(b){var a=this;b.on("change",'select[name="hour_format"]',function(j){var c=jQuery(j.currentTarget).val();var i=jQuery('select[name="start_hour"]',b);var h=i.val();if(typeof a.hourFormatConditionMapping=="undefined"){return false}var g=a.hourFormatConditionMapping.hour_format[c]["start_hour"];var d="";for(var f in g){if(g.hasOwnProperty(f)){var k=g[f];d+='<option value="'+f+'"';if(f==h){d+=' selected="selected" '}d+=">"+k+"</option>"}}i.html(d).trigger("chosen:updated")})},triggerHourFormatChangeEvent:function(a){this.hourFormatConditionMapping=jQuery('input[name="timeFormatOptions"]',a).data("value");this.changeStartHourValuesEvent(a);jQuery('select[name="hour_format"]',a).trigger("change")},registerRecordPreSaveEvent:function(b){var a=this;b.on(Vtiger_Edit_Js.recordPreSave,function(g,d){var j=jQuery('input[name="user_name"]').val();var l=jQuery('input[name="user_password"]').val();var h=jQuery('input[name="confirm_password"]').val();var f=jQuery('input[name="record"]').val();var i=jQuery('[name="email1"]').val();var k=jQuery('[name="user_password"]').val();var c=jQuery.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:"html",blockInfo:{enabled:true}});a.checkEmail(i).then(function(e){},function(m,e){c.progressIndicator({mode:"hide"});g.preventDefault()});if(f==""){if(l!=h){Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_REENTER_PASSWORDS"));c.progressIndicator({mode:"hide"});g.preventDefault()}if(!(j in a.duplicateCheckCache)){a.checkDuplicateUser(j).then(function(e){if(e.result){a.duplicateCheckCache[j]=e.result;c.progressIndicator({mode:"hide"});Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_USER_EXISTS"));g.preventDefault()}},function(m,e){a.duplicateCheckCache[j]=m.result})}else{if(a.duplicateCheckCache[j]==true){Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_USER_EXISTS"));c.progressIndicator({mode:"hide"});g.preventDefault()}}if(a.passCheckCache.name!=k){a.checkPass(k).then(function(e){a.passCheckCache={name:k,result:e.result};Vtiger_Helper_Js.showPnotify(e.result);g.preventDefault()},function(m,e){a.passCheckCache={name:k,result:m.result}})}else{if(a.passCheckCache.result!=false){Vtiger_Helper_Js.showPnotify(a.passCheckCache.result);g.preventDefault()}}}})},checkEmail:function(b){var a=jQuery.Deferred();var c=this;if(c.userExistCheckCache.name!=b){c.userExist(b).then(function(d){c.userExistCheckCache={name:b,status:d.result};a.resolve(true)},function(e,d){c.userExistCheckCache={name:b,status:e.result};Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_USER_MAIL_EXIST"));a.reject()})}else{if(!c.userExistCheckCache.status){Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_USER_MAIL_EXIST"));a.reject()}}return a.promise()},registerCalendarSharedType:function(a){a.find('select[name="calendarsharedtype"]').on("change",function(c){var b=jQuery(c.currentTarget).val();if(b=="seletedusers"){a.find("#selectUsers").show()}else{a.find("#selectUsers").hide()}})},checkDuplicateUser:function(b){var a=jQuery.Deferred();var c={module:app.getModuleName(),action:"SaveAjax",mode:"userExists",user_name:b};AppConnector.request(c).then(function(d){if(d.result){a.resolve(d)}else{a.reject(d)}});return a.promise()},userExist:function(b){var a=jQuery.Deferred();var d={},c=jQuery('[name="record"]').val();d.data={module:"Users",action:"CheckUserEmail",email:b,cUser:c};d.async=false;if(b){AppConnector.request(d).then(function(e){if(e.result){a.resolve(e)}else{a.reject(e)}})}return a.promise()},checkPass:function(b){var a=jQuery.Deferred();var c={};if(b.length){c.data={module:"Users",action:"CheckUserPass",pass:b};c.async=false;AppConnector.request(c).then(function(d){if(d.result){a.resolve(d)}else{a.reject(d)}})}return a.promise()},registerEvents:function(){this._super();var a=this.getForm();this.registerWidthChangeEvent();this.triggerHourFormatChangeEvent(a);this.registerRecordPreSaveEvent(a);this.registerCalendarSharedType(a);Users_Edit_Js.registerChangeEventForCurrencySeperator()}});